# 本地开发说明

## 环境准备

### 1. 安装Python (3.8+)

从 [Python官网](https://www.python.org/downloads/) 下载并安装Python 3.8或更高版本。

### 2. 安装Node.js (16+)

从 [Node.js官网](https://nodejs.org/) 下载并安装Node.js 16或更高版本。

## 后端开发

### 首次运行

```bash
# 1. 进入后端目录
cd backend

# 2. 创建虚拟环境
python -m venv venv

# 3. 激活虚拟环境
# Windows:
venv\Scripts\activate
# macOS/Linux:
source venv/bin/activate

# 4. 安装依赖
pip install -r requirements.txt

# 5. 复制环境变量配置文件
copy env.example .env  # Windows
# cp env.example .env  # macOS/Linux

# 6. 执行数据库迁移
python manage.py migrate

# 7. 创建超级用户（用于登录后台）
python manage.py createsuperuser

# 8. 启动开发服务器
python manage.py runserver
```

后端服务将在 `http://localhost:8000` 启动。

访问：
- API文档: http://localhost:8000/api/docs/
- 管理后台: http://localhost:8000/admin/

### 日常开发

```bash
# 激活虚拟环境
cd backend
venv\Scripts\activate  # Windows
# source venv/bin/activate  # macOS/Linux

# 启动服务器
python manage.py runserver
```

### 常用命令

```bash
# 创建新的Django应用
python manage.py startapp app_name

# 创建数据库迁移文件
python manage.py makemigrations

# 执行数据库迁移
python manage.py migrate

# 创建超级用户
python manage.py createsuperuser

# 收集静态文件
python manage.py collectstatic

# 进入Django Shell
python manage.py shell
```

## 前端开发

### 首次运行

```bash
# 1. 进入前端目录
cd frontend

# 2. 安装依赖
npm install

# 3. 启动开发服务器
npm run dev
```

前端服务将在 `http://localhost:5173` 启动。

### 日常开发

```bash
cd frontend
npm run dev
```

### 打包生产环境

```bash
cd frontend
npm run build
```

打包产物会输出到根目录的 `dist/` 文件夹。

## 联调开发

1. 启动后端服务器（8000端口）
2. 启动前端开发服务器（5173端口）
3. 前端会通过Vite的proxy功能自动将 `/api` 请求转发到后端

访问 `http://localhost:5173` 进行开发。

## 推送到Git

```bash
# 1. 确保前端已打包
cd frontend
npm run build
cd ..

# 2. 添加到Git
git add .

# 3. 提交
git commit -m "描述你的修改"

# 4. 推送到远程仓库
git push origin main
```

**注意**: 根据.gitignore配置，只有以下内容会被推送：
- `backend/` - 后端代码
- `dist/` - 前端打包产物
- `*.md` - 文档文件
- `deploy.sh` / `deploy.bat` - 部署脚本
- `.gitignore`

`frontend/` 源代码目录不会被推送到Git（在本地保留用于开发）。

## 常见问题

### 1. Django提示找不到模块

确保已激活虚拟环境并安装了所有依赖：
```bash
pip install -r requirements.txt
```

### 2. 前端API请求失败

检查：
- 后端服务器是否在8000端口运行
- 前端vite.config.js中的proxy配置是否正确
- 浏览器控制台的错误信息

### 3. 数据库迁移错误

删除数据库文件和迁移文件重新开始：
```bash
# 删除db.sqlite3
# 删除各app下的migrations目录中的数字开头的文件
python manage.py makemigrations
python manage.py migrate
```

### 4. CORS跨域问题

确保后端settings.py中的CORS配置包含了前端地址：
```python
CORS_ALLOWED_ORIGINS = [
    'http://localhost:5173',
    'http://127.0.0.1:5173',
]
```

## 开发工具推荐

- VS Code
- PyCharm (Python开发)
- WebStorm (前端开发)
- Postman (API测试)

