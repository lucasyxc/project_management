# 本地测试说明

## 快速测试（3分钟搞定）

### 1️⃣ 测试后端

```bash
# 进入后端目录
cd backend

# 创建虚拟环境（只需第一次）
python -m venv venv

# 激活虚拟环境
venv\Scripts\activate

# 安装依赖（只需第一次）
pip install -r requirements.txt

# 数据库迁移（只需第一次）
python manage.py migrate

# 启动后端（默认8000端口）
python manage.py runserver

# 如果8000端口被占用，使用其他端口：
python manage.py runserver 8001
```

**测试**: 浏览器访问 http://localhost:8000/api/test/ （或8001）  
应该看到：`{"status":"success","message":"后端服务运行正常！",...}`

---

### 2️⃣ 测试前端

**新开一个终端窗口**

```bash
# 进入前端目录
cd frontend

# 安装依赖（只需第一次）
npm install

# 启动开发服务器
npm run dev
```

**测试**: 浏览器访问 http://localhost:5173/test  
应该看到测试页面，点击"测试后端连接"按钮

---

### 3️⃣ 打包前端

```bash
cd frontend
npm run build
```

打包产物在根目录的 `dist/` 文件夹

---

## 推送到Git

```bash
# 回到项目根目录
cd ..

# 添加文件
git add .

# 提交
git commit -m "添加测试功能"

# 推送（首次）
git push -u origin master

# 推送（日常）
git push
```

---

## 服务器测试（端口调整版）

### 端口说明
- 前端: **8080端口** (80被占用)
- 后端: **8001端口** (8000被占用)

### 拉取代码并运行

```bash
# 克隆或拉取代码
git clone https://github.com/lucasyxc/project_management.git
cd project_management

# 或者拉取更新
git pull origin master

# 后端设置
cd backend
python3 -m venv venv
source venv/bin/activate  # Linux
pip install -r requirements.txt
python manage.py migrate

# 启动后端（使用8001端口）
gunicorn --bind 0.0.0.0:8001 --workers 3 project_management.wsgi:application

# 或开发模式
python manage.py runserver 0.0.0.0:8001
```

### Nginx配置（使用8080端口）

编辑 `/etc/nginx/sites-available/project-management`:

```nginx
server {
    listen 8080;
    server_name your-ip-or-domain;

    location / {
        root /path/to/project_management/dist;
        try_files $uri $uri/ /index.html;
    }

    location /api/ {
        proxy_pass http://127.0.0.1:8001;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

```bash
# 启用配置
sudo ln -s /etc/nginx/sites-available/project-management /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

### 测试访问

- 前端: http://your-server-ip:8080
- 测试页面: http://your-server-ip:8080/test
- API测试: http://your-server-ip:8080/api/test/
- 后端直连: http://your-server-ip:8001/api/test/

---

## 常见端口配置

如果这些端口也被占用，可以改用：

**前端可选端口**: 8080, 8888, 9000, 3000, 5000  
**后端可选端口**: 8001, 8002, 9001, 5001

修改方式：
- 后端: `python manage.py runserver 端口号`
- Gunicorn: `gunicorn --bind 0.0.0.0:端口号 ...`
- Nginx: 修改 `listen 端口号;` 和 `proxy_pass http://127.0.0.1:后端端口;`

