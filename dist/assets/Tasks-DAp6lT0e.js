import{_ as R,r as v,z as F,o as P,c as r,a as n,b as c,w as d,d as p,F as T,v as $,h as f,E as u,j as U,e as a,x as y,t as i,f as j,g,q,k as b}from"./index-DvnI5NRD.js";const I={class:"mobile-tasks"},L={class:"filters"},A={key:0,class:"empty-tip"},G={key:1,class:"task-list"},H={class:"task-header"},J={class:"task-step"},K={class:"task-title"},O={class:"task-project"},Q={class:"task-info"},W={key:0},X={__name:"Tasks",setup(Y){U();const w=v([]),k=v([]),_=v(null),m=v(null),C=F(()=>{let t=w.value;return _.value&&(t=t.filter(s=>s.project===_.value)),m.value&&(t=t.filter(s=>s.status===m.value)),t}),x=t=>({in_progress:"warning",overdue:"danger",completed:"success"})[t]||"info",S=t=>({in_progress:"进行中",overdue:"已超期",completed:"已完成"})[t]||t,h=async()=>{try{const s=(await f.get("/api/projects/stages/",{params:{page_size:100}})).data.results||[],l={};k.value.forEach(o=>{l[o.id]=o.name}),w.value=s.map(o=>({...o,project_name:l[o.project]||"未知项目"}))}catch{u.error("加载任务列表失败")}},B=async()=>{try{const t=await f.get("/api/projects/",{params:{page_size:100}});k.value=t.data.results||[],h()}catch{u.error("加载项目列表失败")}},E=async t=>{try{await f.post(`/api/projects/stages/${t.id}/done/`),u.success("已完成"),h()}catch{u.error("操作失败")}},M=async t=>{try{await f.post(`/api/projects/stages/${t.id}/redo/`),u.success("已改为重做中"),h()}catch{u.error("操作失败")}};return P(()=>{B()}),(t,s)=>{const l=p("el-option"),o=p("el-select"),N=p("el-tag"),V=p("el-button"),D=p("el-card");return a(),r("div",I,[n("div",L,[c(o,{modelValue:_.value,"onUpdate:modelValue":s[0]||(s[0]=e=>_.value=e),clearable:"",placeholder:"筛选项目",size:"default"},{default:d(()=>[(a(!0),r(T,null,$(k.value,e=>(a(),y(l,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),c(o,{modelValue:m.value,"onUpdate:modelValue":s[1]||(s[1]=e=>m.value=e),clearable:"",placeholder:"筛选状态",size:"default"},{default:d(()=>[c(l,{label:"进行中",value:"in_progress"}),c(l,{label:"已超期",value:"overdue"}),c(l,{label:"已完成",value:"completed"})]),_:1},8,["modelValue"])]),C.value.length===0?(a(),r("div",A,"暂无任务")):(a(),r("div",G,[(a(!0),r(T,null,$(C.value,e=>(a(),y(D,{key:e.id,class:"task-card",onClick:z=>t.$router.push(`/m/projects/${e.project}`)},{default:d(()=>[n("div",H,[n("div",J,"Step "+i(e.order+1),1),c(N,{type:x(e.status),size:"small"},{default:d(()=>[j(i(S(e.status)),1)]),_:2},1032,["type"])]),n("div",K,i(e.name),1),n("div",O,"项目: "+i(e.project_name),1),n("div",Q,[e.owner_name?(a(),r("span",W,"👤 "+i(e.owner_name),1)):g("",!0),e.deadline?(a(),r("span",{key:1,class:q({overdue:e.status==="overdue"})}," 📅 "+i(e.deadline),3)):g("",!0)]),n("div",{class:"task-actions",onClick:s[2]||(s[2]=b(()=>{},["stop"]))},[e.status!=="completed"?(a(),y(V,{key:0,type:e.status==="overdue"?"danger":"success",size:"small",onClick:b(z=>E(e),["stop"])},{default:d(()=>[...s[3]||(s[3]=[j(" Done ",-1)])]),_:1},8,["type","onClick"])):g("",!0),e.status==="completed"?(a(),y(V,{key:1,type:"warning",size:"small",onClick:b(z=>M(e),["stop"])},{default:d(()=>[...s[4]||(s[4]=[j(" Redo ",-1)])]),_:1},8,["onClick"])):g("",!0)])]),_:2},1032,["onClick"]))),128))]))])}}},ee=R(X,[["__scopeId","data-v-e3c5397c"]]);export{ee as default};
