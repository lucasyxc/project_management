import{_ as ee,r as p,i as te,o as le,c as j,b as t,w as a,d as r,h as g,E as d,j as oe,e as v,f as i,t as T,a as w,F as z,v as E,x as S,y as ae}from"./index-DvnI5NRD.js";const ne={class:"projects"},re={class:"card-header"},se={__name:"Projects",setup(ie){const D=oe(),k=p([]),x=p(1),F=p(20),C=p(0),_=p(!1),f=p(null),n=te({name:"",description:"",status:"not_started",priority:"low",owner:null,members:[]}),V=p([]),M=o=>({not_started:"info",in_progress:"warning",completed:"success"})[o]||"info",N=o=>({not_started:"未开始",in_progress:"进行中",completed:"已完成"})[o]||o,h=o=>({low:"info",medium:"",high:"warning",urgent:"danger"})[o]||"",O=o=>({low:"低",medium:"中",high:"高",urgent:"紧急"})[o]||o,y=async()=>{try{const o=await g.get("/api/projects/",{params:{page:x.value}});k.value=o.data.results||[],C.value=o.data.count||0}catch{d.error("加载项目列表失败")}},q=o=>{D.push(`/projects/${o}`)},I=o=>{f.value=o,Object.assign(n,{...o,members:o.members||[]}),_.value=!0},L=async()=>{try{const o=await g.get("/api/users/",{params:{page_size:100}});V.value=(o.data.results||[]).filter(e=>e.username!=="admin")}catch{console.error("加载用户列表失败")}},R=async()=>{if(!n.name){d.warning("请输入项目名称");return}try{const o={...n};o.owner||(o.owner=null),o.description||(o.description=""),f.value?(await g.put(`/api/projects/${f.value.id}/`,o),d.success("项目更新成功")):(await g.post("/api/projects/",o),d.success("项目创建成功")),P(),y()}catch{d.error("保存失败")}},A=async o=>{try{await ae.confirm("确定要删除此项目吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await g.delete(`/api/projects/${o.id}/`),d.success("项目删除成功"),y()}catch(e){e!=="cancel"&&d.error("删除失败")}},P=()=>{_.value=!1,f.value=null,Object.assign(n,{name:"",description:"",status:"not_started",priority:"low",owner:null,members:[]})};return le(()=>{y(),L()}),(o,e)=>{const G=r("Plus"),H=r("el-icon"),m=r("el-button"),u=r("el-table-column"),$=r("el-tag"),J=r("el-progress"),K=r("el-table"),Q=r("el-pagination"),W=r("el-card"),U=r("el-input"),c=r("el-form-item"),s=r("el-option"),b=r("el-select"),X=r("el-alert"),Y=r("el-form"),Z=r("el-dialog");return v(),j("div",ne,[t(W,null,{header:a(()=>[w("div",re,[e[10]||(e[10]=w("h3",null,"项目列表",-1)),t(m,{type:"primary",onClick:e[0]||(e[0]=l=>_.value=!0)},{default:a(()=>[t(H,null,{default:a(()=>[t(G)]),_:1}),e[9]||(e[9]=i(" 新建项目 ",-1))]),_:1})])]),default:a(()=>[t(K,{data:k.value,stripe:""},{default:a(()=>[t(u,{prop:"name",label:"项目名称","min-width":"200"}),t(u,{prop:"owner_name",label:"负责人",width:"120"}),t(u,{prop:"status",label:"状态",width:"100"},{default:a(({row:l})=>[t($,{type:M(l.status)},{default:a(()=>[i(T(N(l.status)),1)]),_:2},1032,["type"])]),_:1}),t(u,{prop:"priority",label:"优先级",width:"100"},{default:a(({row:l})=>[t($,{type:h(l.priority)},{default:a(()=>[i(T(O(l.priority)),1)]),_:2},1032,["type"])]),_:1}),t(u,{prop:"progress",label:"进度",width:"120"},{default:a(({row:l})=>[t(J,{percentage:l.progress},null,8,["percentage"])]),_:1}),t(u,{prop:"start_date",label:"开始日期",width:"120"}),t(u,{prop:"end_date",label:"结束日期",width:"120"}),t(u,{label:"操作",width:"150",fixed:"right"},{default:a(({row:l})=>[t(m,{link:"",type:"primary",onClick:B=>q(l.id)},{default:a(()=>[...e[11]||(e[11]=[i("查看",-1)])]),_:1},8,["onClick"]),t(m,{link:"",type:"primary",onClick:B=>I(l)},{default:a(()=>[...e[12]||(e[12]=[i("编辑",-1)])]),_:1},8,["onClick"]),t(m,{link:"",type:"danger",onClick:B=>A(l)},{default:a(()=>[...e[13]||(e[13]=[i("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),t(Q,{"current-page":x.value,"onUpdate:currentPage":e[1]||(e[1]=l=>x.value=l),"page-size":F.value,total:C.value,layout:"total, prev, pager, next",onCurrentChange:y},null,8,["current-page","page-size","total"])]),_:1}),t(Z,{modelValue:_.value,"onUpdate:modelValue":e[8]||(e[8]=l=>_.value=l),title:f.value?"编辑项目":"新建项目",width:"600px"},{footer:a(()=>[t(m,{onClick:P},{default:a(()=>[...e[17]||(e[17]=[i("取消",-1)])]),_:1}),t(m,{type:"primary",onClick:R},{default:a(()=>[...e[18]||(e[18]=[i("保存",-1)])]),_:1})]),default:a(()=>[t(Y,{model:n,"label-width":"100px"},{default:a(()=>[t(c,{label:"项目名称",required:""},{default:a(()=>[t(U,{modelValue:n.name,"onUpdate:modelValue":e[2]||(e[2]=l=>n.name=l),placeholder:"输入项目名称"},null,8,["modelValue"])]),_:1}),t(c,{label:"项目负责人"},{default:a(()=>[t(b,{modelValue:n.owner,"onUpdate:modelValue":e[3]||(e[3]=l=>n.owner=l),clearable:"",placeholder:"选择负责人（可不选）"},{default:a(()=>[(v(!0),j(z,null,E(V.value,l=>(v(),S(s,{key:l.id,label:`${l.username}${l.first_name?" - "+l.first_name+l.last_name:""}`,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(c,{label:"项目关联人"},{default:a(()=>[t(b,{modelValue:n.members,"onUpdate:modelValue":e[4]||(e[4]=l=>n.members=l),multiple:"",clearable:"",placeholder:"选择关联人（可多选）",style:{width:"100%"}},{default:a(()=>[(v(!0),j(z,null,E(V.value,l=>(v(),S(s,{key:l.id,label:`${l.username}${l.first_name?" - "+l.first_name+l.last_name:""}`,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e[14]||(e[14]=w("div",{style:{"font-size":"12px",color:"#909399","margin-top":"5px"}}," 关联人可以查看和管理此项目，阶段负责人会自动加入关联人 ",-1))]),_:1}),t(c,{label:"项目描述"},{default:a(()=>[t(U,{modelValue:n.description,"onUpdate:modelValue":e[5]||(e[5]=l=>n.description=l),type:"textarea",rows:3,placeholder:"项目描述（可不填）"},null,8,["modelValue"])]),_:1}),t(c,{label:"状态"},{default:a(()=>[t(b,{modelValue:n.status,"onUpdate:modelValue":e[6]||(e[6]=l=>n.status=l),disabled:""},{default:a(()=>[t(s,{label:"未开始",value:"not_started"}),t(s,{label:"进行中",value:"in_progress"}),t(s,{label:"已完成",value:"completed"})]),_:1},8,["modelValue"]),e[15]||(e[15]=w("div",{style:{"font-size":"12px",color:"#909399","margin-top":"5px"}}," 状态由阶段自动决定，不可手动修改 ",-1))]),_:1}),t(c,{label:"优先级"},{default:a(()=>[t(b,{modelValue:n.priority,"onUpdate:modelValue":e[7]||(e[7]=l=>n.priority=l)},{default:a(()=>[t(s,{label:"低",value:"low"}),t(s,{label:"中",value:"medium"}),t(s,{label:"高",value:"high"}),t(s,{label:"紧急",value:"urgent"})]),_:1},8,["modelValue"])]),_:1}),t(X,{type:"info",closable:!1,style:{"margin-top":"10px"},"show-icon":""},{default:a(()=>[...e[16]||(e[16]=[i(" 项目的开始日期和截止日期将根据阶段完成情况自动计算 ",-1)])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},pe=ee(se,[["__scopeId","data-v-d17a0fcf"]]);export{pe as default};
