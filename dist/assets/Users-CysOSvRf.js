import{_ as le,u as te,r as v,i as ae,o as oe,c,x as U,g as b,b as t,l as C,w as o,d as m,F as h,v as q,h as _,E as n,e as r,a as x,f as u,t as y,y as O}from"./index-DbjfBYFQ.js";const se={class:"mobile-users"},ne={style:{display:"flex","justify-content":"space-between","align-items":"center"}},re={style:{display:"flex","flex-wrap":"wrap",gap:"8px"}},ue={key:1,class:"empty-tip"},ie={key:2,class:"user-list"},de={class:"user-header"},pe={class:"user-name"},me={key:0,class:"user-info"},ce={key:1,class:"user-info"},fe={key:2,class:"user-info"},ve={class:"user-actions"},_e={key:0,style:{"font-size":"12px",color:"#909399"}},ye={__name:"Users",setup(Ve){const V=te(),E=v([]),N=v([]),$=v(!1),G=v(!1),B=v(!1),f=v(null),w=v(null),I=v(""),k=v(""),s=ae({username:"",password:"",email:"",first_name:"",last_name:"",phone:"",department:"",position:"",group:null,is_active:!0}),z=async()=>{try{const a=await _.get("/api/users/");E.value=a.data.results||[]}catch{n.error("加载用户列表失败")}},D=async()=>{try{const a=await _.get("/api/users/groups/");N.value=a.data.results||a.data||[]}catch{console.error("加载分组失败")}},P=async()=>{if(!I.value){n.warning("请输入分组名称");return}try{await _.post("/api/users/groups/",{name:I.value}),n.success("分组创建成功"),I.value="",G.value=!1,D()}catch{n.error("创建失败")}},L=a=>{w.value=a,k.value=a.name,B.value=!0},A=async()=>{if(!k.value){n.warning("请输入分组名称");return}try{await _.put(`/api/users/groups/${w.value.id}/`,{name:k.value,description:w.value.description}),n.success("分组更新成功"),B.value=!1,w.value=null,k.value="",D()}catch{n.error("更新失败")}},H=()=>{B.value=!1,w.value=null,k.value=""},J=async a=>{try{await O.confirm(`确定删除分组"${a.name}"？`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await _.delete(`/api/users/groups/${a.id}/`),n.success("分组删除成功"),D(),z()}catch(e){e!=="cancel"&&n.error("删除失败")}},K=a=>{f.value=a,Object.assign(s,{username:a.username,password:"",email:a.email||"",first_name:a.first_name||"",last_name:a.last_name||"",phone:a.phone||"",department:a.department||"",position:a.position||"",group:a.group||null,is_active:a.is_active}),$.value=!0},Q=async()=>{try{const a={...s};f.value?(a.password||delete a.password,delete a.username,await _.put(`/api/users/${f.value.id}/`,a),n.success("用户更新成功")):(await _.post("/api/users/",a),n.success("子账号创建成功")),S(),z()}catch{n.error("保存失败")}},R=async a=>{try{await _.patch(`/api/users/${a.id}/`,{is_active:!a.is_active}),n.success("操作成功"),z()}catch{n.error("操作失败")}},W=async a=>{try{await O.confirm(`确定删除用户 ${a.username}?`,"警告",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"error"}),await _.delete(`/api/users/${a.id}/`),n.success("用户删除成功"),z()}catch(e){e!=="cancel"&&n.error("删除失败")}},S=()=>{$.value=!1,f.value=null,Object.assign(s,{username:"",password:"",email:"",first_name:"",last_name:"",phone:"",department:"",position:"",group:null,is_active:!0})};return oe(async()=>{V.userInfo||await V.getUserInfo(),z(),D()}),(a,e)=>{const i=m("el-button"),j=m("el-tag"),F=m("el-card"),X=m("Plus"),Y=m("el-icon"),d=m("el-input"),p=m("el-form-item"),Z=m("el-option"),ee=m("el-select"),M=m("el-form"),T=m("el-dialog");return r(),c("div",se,[C(V).userInfo&&(C(V).userInfo.is_staff||C(V).userInfo.is_superuser)?(r(),U(F,{key:0,style:{"margin-bottom":"10px"}},{header:o(()=>[x("div",ne,[e[19]||(e[19]=x("h4",null,"用户分组",-1)),t(i,{type:"primary",size:"small",onClick:e[0]||(e[0]=l=>G.value=!0)},{default:o(()=>[...e[18]||(e[18]=[u(" 新建分组 ",-1)])]),_:1})])]),default:o(()=>[x("div",re,[(r(!0),c(h,null,q(N.value,l=>(r(),U(j,{key:l.id,closable:"",onClose:g=>J(l),style:{cursor:"pointer"},onClick:g=>L(l)},{default:o(()=>[u(y(l.name)+" ("+y(l.member_count)+"人) ",1)]),_:2},1032,["onClose","onClick"]))),128))])]),_:1})):b("",!0),t(i,{type:"primary",style:{width:"100%","margin-bottom":"10px"},onClick:e[1]||(e[1]=l=>$.value=!0)},{default:o(()=>[t(Y,null,{default:o(()=>[t(X)]),_:1}),e[20]||(e[20]=u(" 创建子账号 ",-1))]),_:1}),E.value.length===0?(r(),c("div",ue,"暂无用户")):(r(),c("div",ie,[(r(!0),c(h,null,q(E.value,l=>(r(),U(F,{key:l.id,class:"user-card"},{default:o(()=>[x("div",de,[x("div",pe,y(l.username),1),t(j,{type:l.is_active?"success":"danger",size:"small"},{default:o(()=>[u(y(l.is_active?"激活":"禁用"),1)]),_:2},1032,["type"])]),l.first_name||l.last_name?(r(),c("div",me," 姓名: "+y(l.first_name)+" "+y(l.last_name),1)):b("",!0),l.department?(r(),c("div",ce," 部门: "+y(l.department),1)):b("",!0),l.position?(r(),c("div",fe," 职位: "+y(l.position),1)):b("",!0),x("div",ve,[t(i,{size:"small",onClick:g=>K(l)},{default:o(()=>[...e[21]||(e[21]=[u("编辑",-1)])]),_:1},8,["onClick"]),t(i,{size:"small",type:l.is_active?"warning":"success",onClick:g=>R(l)},{default:o(()=>[u(y(l.is_active?"禁用":"激活"),1)]),_:2},1032,["type","onClick"]),t(i,{size:"small",type:"danger",onClick:g=>W(l)},{default:o(()=>[...e[22]||(e[22]=[u("删除",-1)])]),_:1},8,["onClick"])])]),_:2},1024))),128))])),t(T,{modelValue:$.value,"onUpdate:modelValue":e[11]||(e[11]=l=>$.value=l),title:f.value?"编辑用户":"创建子账号",fullscreen:!0},{footer:o(()=>[t(i,{onClick:S,style:{width:"48%"}},{default:o(()=>[...e[23]||(e[23]=[u("取消",-1)])]),_:1}),t(i,{type:"primary",onClick:Q,style:{width:"48%"}},{default:o(()=>[...e[24]||(e[24]=[u("保存",-1)])]),_:1})]),default:o(()=>[t(M,{model:s,"label-position":"top"},{default:o(()=>[t(p,{label:"用户名",required:!f.value},{default:o(()=>[t(d,{modelValue:s.username,"onUpdate:modelValue":e[2]||(e[2]=l=>s.username=l),disabled:!!f.value,placeholder:"登录账号"},null,8,["modelValue","disabled"])]),_:1},8,["required"]),t(p,{label:"密码",required:!f.value},{default:o(()=>[t(d,{modelValue:s.password,"onUpdate:modelValue":e[3]||(e[3]=l=>s.password=l),type:"password",placeholder:"至少6位","show-password":""},null,8,["modelValue"]),f.value?(r(),c("div",_e,"留空表示不修改密码")):b("",!0)]),_:1},8,["required"]),t(p,{label:"邮箱"},{default:o(()=>[t(d,{modelValue:s.email,"onUpdate:modelValue":e[4]||(e[4]=l=>s.email=l),placeholder:"user@example.com"},null,8,["modelValue"])]),_:1}),t(p,{label:"姓"},{default:o(()=>[t(d,{modelValue:s.first_name,"onUpdate:modelValue":e[5]||(e[5]=l=>s.first_name=l),placeholder:"姓"},null,8,["modelValue"])]),_:1}),t(p,{label:"名"},{default:o(()=>[t(d,{modelValue:s.last_name,"onUpdate:modelValue":e[6]||(e[6]=l=>s.last_name=l),placeholder:"名"},null,8,["modelValue"])]),_:1}),t(p,{label:"手机号"},{default:o(()=>[t(d,{modelValue:s.phone,"onUpdate:modelValue":e[7]||(e[7]=l=>s.phone=l),placeholder:"手机号码"},null,8,["modelValue"])]),_:1}),t(p,{label:"部门"},{default:o(()=>[t(d,{modelValue:s.department,"onUpdate:modelValue":e[8]||(e[8]=l=>s.department=l),placeholder:"所属部门"},null,8,["modelValue"])]),_:1}),t(p,{label:"职位"},{default:o(()=>[t(d,{modelValue:s.position,"onUpdate:modelValue":e[9]||(e[9]=l=>s.position=l),placeholder:"职位名称"},null,8,["modelValue"])]),_:1}),C(V).userInfo&&(C(V).userInfo.is_staff||C(V).userInfo.is_superuser)?(r(),U(p,{key:0,label:"所属分组"},{default:o(()=>[t(ee,{modelValue:s.group,"onUpdate:modelValue":e[10]||(e[10]=l=>s.group=l),clearable:"",placeholder:"选择分组（可不选）",style:{width:"100%"}},{default:o(()=>[(r(!0),c(h,null,q(N.value,l=>(r(),U(Z,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):b("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(T,{modelValue:G.value,"onUpdate:modelValue":e[14]||(e[14]=l=>G.value=l),title:"新建分组",width:"90%"},{footer:o(()=>[t(i,{onClick:e[13]||(e[13]=l=>G.value=!1),style:{width:"48%"}},{default:o(()=>[...e[25]||(e[25]=[u("取消",-1)])]),_:1}),t(i,{type:"primary",onClick:P,style:{width:"48%"}},{default:o(()=>[...e[26]||(e[26]=[u("创建",-1)])]),_:1})]),default:o(()=>[t(d,{modelValue:I.value,"onUpdate:modelValue":e[12]||(e[12]=l=>I.value=l),placeholder:"输入分组名称"},null,8,["modelValue"])]),_:1},8,["modelValue"]),t(T,{modelValue:B.value,"onUpdate:modelValue":e[17]||(e[17]=l=>B.value=l),title:"编辑分组",width:"90%"},{footer:o(()=>[t(i,{onClick:H,style:{width:"48%"}},{default:o(()=>[...e[27]||(e[27]=[u("取消",-1)])]),_:1}),t(i,{type:"primary",onClick:A,style:{width:"48%"}},{default:o(()=>[...e[28]||(e[28]=[u("保存",-1)])]),_:1})]),default:o(()=>[t(M,null,{default:o(()=>{var l;return[t(p,{label:"分组名称"},{default:o(()=>[t(d,{modelValue:k.value,"onUpdate:modelValue":e[15]||(e[15]=g=>k.value=g),placeholder:"输入分组名称"},null,8,["modelValue"])]),_:1}),(l=w.value)!=null&&l.description?(r(),U(p,{key:0,label:"描述"},{default:o(()=>[t(d,{modelValue:w.value.description,"onUpdate:modelValue":e[16]||(e[16]=g=>w.value.description=g),type:"textarea",placeholder:"分组描述",rows:3},null,8,["modelValue"])]),_:1})):b("",!0)]}),_:1})]),_:1},8,["modelValue"])])}}},ge=le(ye,[["__scopeId","data-v-4d2d2025"]]);export{ge as default};
