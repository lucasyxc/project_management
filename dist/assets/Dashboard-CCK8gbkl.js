import{_ as N,u as C,r as T,o as L,c as m,b as s,w as e,d,h as P,e as u,a as t,t as n,x as S,F as $,v as B,f as D}from"./index-DbjfBYFQ.js";const R={class:"dashboard"},V={class:"stats-content"},W={class:"stats-value"},E={class:"stats-content"},M={class:"stats-value"},O={class:"stats-content"},z={class:"stats-value"},U={class:"stats-content"},q={class:"stats-value"},A={key:1},G=["onClick"],H={class:"project-name"},J={class:"project-meta"},K={key:1},Q=["onClick"],X={class:"task-title"},Y={class:"task-meta"},Z={__name:"Dashboard",setup(ss){C();const _=T({totalProjects:0,totalTasks:0,inProgressTasks:0,overdueTasks:0}),h=T([]),k=T([]),j=c=>({not_started:"info",in_progress:"warning",completed:"success",todo:"info",review:""})[c]||"info",w=c=>({not_started:"未开始",in_progress:"进行中",completed:"已完成",todo:"待办",review:"待审核"})[c]||c,F=async()=>{var c,a;try{const v=C(),p=await P.get("/api/projects/");h.value=((c=p.data.results)==null?void 0:c.slice(0,5))||[],_.value.totalProjects=p.data.count||0;const i=(await P.get("/api/projects/stages/",{params:{page_size:1e3}})).data.results||[],g={};(a=p.data.results)==null||a.forEach(l=>{g[l.id]=l.name});const y=i.map(l=>({...l,project_name:g[l.project]||"未知项目"}));if(v.userInfo){const l=i.filter(r=>r.owner===v.userInfo.id);_.value.totalTasks=l.length,_.value.inProgressTasks=l.filter(r=>r.status==="in_progress").length,_.value.overdueTasks=l.filter(r=>r.status==="overdue").length,k.value=y.filter(r=>r.owner===v.userInfo.id).slice(0,5)}}catch(v){console.error("加载数据失败:",v)}};return L(()=>{F()}),(c,a)=>{const v=d("FolderOpened"),p=d("el-icon"),f=d("el-card"),i=d("el-col"),g=d("List"),y=d("Clock"),l=d("Warning"),r=d("el-row"),b=d("el-empty"),x=d("el-tag");return u(),m("div",R,[s(r,{gutter:20},{default:e(()=>[s(i,{span:6},{default:e(()=>[s(f,{class:"stats-card"},{default:e(()=>[t("div",V,[s(p,{class:"stats-icon",color:"#409eff"},{default:e(()=>[s(v)]),_:1}),t("div",null,[t("div",W,n(_.value.totalProjects),1),a[0]||(a[0]=t("div",{class:"stats-label"},"总项目数",-1))])])]),_:1})]),_:1}),s(i,{span:6},{default:e(()=>[s(f,{class:"stats-card"},{default:e(()=>[t("div",E,[s(p,{class:"stats-icon",color:"#67c23a"},{default:e(()=>[s(g)]),_:1}),t("div",null,[t("div",M,n(_.value.totalTasks),1),a[1]||(a[1]=t("div",{class:"stats-label"},"我的阶段数",-1))])])]),_:1})]),_:1}),s(i,{span:6},{default:e(()=>[s(f,{class:"stats-card"},{default:e(()=>[t("div",O,[s(p,{class:"stats-icon",color:"#e6a23c"},{default:e(()=>[s(y)]),_:1}),t("div",null,[t("div",z,n(_.value.inProgressTasks),1),a[2]||(a[2]=t("div",{class:"stats-label"},"进行中",-1))])])]),_:1})]),_:1}),s(i,{span:6},{default:e(()=>[s(f,{class:"stats-card"},{default:e(()=>[t("div",U,[s(p,{class:"stats-icon",color:"#f56c6c"},{default:e(()=>[s(l)]),_:1}),t("div",null,[t("div",q,n(_.value.overdueTasks),1),a[3]||(a[3]=t("div",{class:"stats-label"},"已超期",-1))])])]),_:1})]),_:1})]),_:1}),s(r,{gutter:20,style:{"margin-top":"20px"}},{default:e(()=>[s(i,{span:12},{default:e(()=>[s(f,null,{header:e(()=>[...a[4]||(a[4]=[t("h3",null,"最近项目",-1)])]),default:e(()=>[h.value.length===0?(u(),S(b,{key:0,description:"暂无项目"})):(u(),m("div",A,[(u(!0),m($,null,B(h.value,o=>(u(),m("div",{key:o.id,class:"project-item",onClick:I=>c.$router.push(`/projects/${o.id}`)},[t("div",null,[t("div",H,n(o.name),1),t("div",J,n(o.owner_name)+" · "+n(o.created_at),1)]),s(x,{type:j(o.status)},{default:e(()=>[D(n(w(o.status)),1)]),_:2},1032,["type"])],8,G))),128))]))]),_:1})]),_:1}),s(i,{span:12},{default:e(()=>[s(f,null,{header:e(()=>[...a[5]||(a[5]=[t("h3",null,"我的任务（我负责的阶段）",-1)])]),default:e(()=>[k.value.length===0?(u(),S(b,{key:0,description:"暂无任务"})):(u(),m("div",K,[(u(!0),m($,null,B(k.value,o=>(u(),m("div",{key:o.id,class:"task-item",onClick:I=>c.$router.push(`/projects/${o.project}`)},[t("div",null,[t("div",X,n(o.name),1),t("div",Y,n(o.project_name)+" · "+n(o.deadline||"无截止日期"),1)]),s(x,{type:j(o.status)},{default:e(()=>[D(n(w(o.status)),1)]),_:2},1032,["type"])],8,Q))),128))]))]),_:1})]),_:1})]),_:1})])}}},es=N(Z,[["__scopeId","data-v-43cd51de"]]);export{es as default};
