import{_ as te,r as p,i as le,o as ae,c as f,b as l,w as o,d as s,h as v,E as m,j as oe,e as d,f as u,t as V,a as b,g as ne,F as B,v as T,z as D,A as se}from"./index-TwG3oDm_.js";const re={class:"projects"},ie={class:"card-header"},ue={key:0},de={key:0,style:{"font-size":"12px",color:"#e6a23c"}},pe={key:1,style:{color:"#909399"}},me={__name:"Projects",setup(ce){const N=oe(),C=p([]),k=p(1),E=p(20),P=p(0),g=p(!1),y=p(null),n=le({name:"",description:"",status:"not_started",priority:"low",owner:null,members:[]}),j=p([]),S=a=>({not_started:"info",in_progress:"warning",completed:"success"})[a]||"info",F=a=>({not_started:"未开始",in_progress:"进行中",completed:"已完成"})[a]||a,M=a=>({low:"info",medium:"",high:"warning",urgent:"danger"})[a]||"",L=a=>({low:"低",medium:"中",high:"高",urgent:"紧急"})[a]||a,O=a=>a?new Date(a).toLocaleDateString("zh-CN"):"",w=async()=>{try{const a=await v.get("/api/projects/",{params:{page:k.value}});C.value=a.data.results||[],P.value=a.data.count||0}catch{m.error("加载项目列表失败")}},q=a=>{N.push(`/projects/${a}`)},A=a=>{y.value=a,Object.assign(n,{...a,members:a.members||[]}),g.value=!0},I=async()=>{try{const a=await v.get("/api/users/",{params:{page_size:100}});j.value=(a.data.results||[]).filter(e=>e.username!=="admin")}catch{console.error("加载用户列表失败")}},R=async()=>{if(!n.name){m.warning("请输入项目名称");return}try{const a={...n};a.owner||(a.owner=null),a.description||(a.description=""),y.value?(await v.put(`/api/projects/${y.value.id}/`,a),m.success("项目更新成功")):(await v.post("/api/projects/",a),m.success("项目创建成功")),$(),w()}catch{m.error("保存失败")}},G=async a=>{try{await se.confirm("确定要删除此项目吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await v.delete(`/api/projects/${a.id}/`),m.success("项目删除成功"),w()}catch(e){e!=="cancel"&&m.error("删除失败")}},$=()=>{g.value=!1,y.value=null,Object.assign(n,{name:"",description:"",status:"not_started",priority:"low",owner:null,members:[]})};return ae(()=>{w(),I()}),(a,e)=>{const H=s("Plus"),J=s("el-icon"),c=s("el-button"),r=s("el-table-column"),z=s("el-tag"),K=s("el-progress"),Q=s("el-table"),W=s("el-pagination"),X=s("el-card"),U=s("el-input"),_=s("el-form-item"),i=s("el-option"),x=s("el-select"),Y=s("el-alert"),Z=s("el-form"),ee=s("el-dialog");return d(),f("div",re,[l(X,null,{header:o(()=>[b("div",ie,[e[10]||(e[10]=b("h3",null,"项目列表",-1)),l(c,{type:"primary",onClick:e[0]||(e[0]=t=>g.value=!0)},{default:o(()=>[l(J,null,{default:o(()=>[l(H)]),_:1}),e[9]||(e[9]=u(" 新建项目 ",-1))]),_:1})])]),default:o(()=>[l(Q,{data:C.value,stripe:""},{default:o(()=>[l(r,{prop:"name",label:"项目名称","min-width":"200"}),l(r,{prop:"owner_name",label:"负责人",width:"120"}),l(r,{prop:"status",label:"状态",width:"100"},{default:o(({row:t})=>[l(z,{type:S(t.status)},{default:o(()=>[u(V(F(t.status)),1)]),_:2},1032,["type"])]),_:1}),l(r,{prop:"priority",label:"优先级",width:"100"},{default:o(({row:t})=>[l(z,{type:M(t.priority)},{default:o(()=>[u(V(L(t.priority)),1)]),_:2},1032,["type"])]),_:1}),l(r,{prop:"progress",label:"进度",width:"120"},{default:o(({row:t})=>[l(K,{percentage:t.progress},null,8,["percentage"])]),_:1}),l(r,{label:"当前步骤",width:"200"},{default:o(({row:t})=>[t.current_stage?(d(),f("div",ue,[b("div",null,V(t.current_stage.name),1),t.current_stage.deadline?(d(),f("div",de," 截止: "+V(O(t.current_stage.deadline)),1)):ne("",!0)])):(d(),f("span",pe,"暂无"))]),_:1}),l(r,{prop:"start_date",label:"开始日期",width:"120"}),l(r,{prop:"end_date",label:"结束日期",width:"120"}),l(r,{label:"操作",width:"150",fixed:"right"},{default:o(({row:t})=>[l(c,{link:"",type:"primary",onClick:h=>q(t.id)},{default:o(()=>[...e[11]||(e[11]=[u("查看",-1)])]),_:1},8,["onClick"]),l(c,{link:"",type:"primary",onClick:h=>A(t)},{default:o(()=>[...e[12]||(e[12]=[u("编辑",-1)])]),_:1},8,["onClick"]),l(c,{link:"",type:"danger",onClick:h=>G(t)},{default:o(()=>[...e[13]||(e[13]=[u("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),l(W,{"current-page":k.value,"onUpdate:currentPage":e[1]||(e[1]=t=>k.value=t),"page-size":E.value,total:P.value,layout:"total, prev, pager, next",onCurrentChange:w},null,8,["current-page","page-size","total"])]),_:1}),l(ee,{modelValue:g.value,"onUpdate:modelValue":e[8]||(e[8]=t=>g.value=t),title:y.value?"编辑项目":"新建项目",width:"600px"},{footer:o(()=>[l(c,{onClick:$},{default:o(()=>[...e[17]||(e[17]=[u("取消",-1)])]),_:1}),l(c,{type:"primary",onClick:R},{default:o(()=>[...e[18]||(e[18]=[u("保存",-1)])]),_:1})]),default:o(()=>[l(Z,{model:n,"label-width":"100px"},{default:o(()=>[l(_,{label:"项目名称",required:""},{default:o(()=>[l(U,{modelValue:n.name,"onUpdate:modelValue":e[2]||(e[2]=t=>n.name=t),placeholder:"输入项目名称"},null,8,["modelValue"])]),_:1}),l(_,{label:"项目负责人"},{default:o(()=>[l(x,{modelValue:n.owner,"onUpdate:modelValue":e[3]||(e[3]=t=>n.owner=t),clearable:"",placeholder:"选择负责人（可不选）"},{default:o(()=>[(d(!0),f(B,null,T(j.value,t=>(d(),D(i,{key:t.id,label:`${t.username}${t.first_name?" - "+t.first_name+t.last_name:""}`,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(_,{label:"项目关联人"},{default:o(()=>[l(x,{modelValue:n.members,"onUpdate:modelValue":e[4]||(e[4]=t=>n.members=t),multiple:"",clearable:"",placeholder:"选择关联人（可多选）",style:{width:"100%"}},{default:o(()=>[(d(!0),f(B,null,T(j.value,t=>(d(),D(i,{key:t.id,label:`${t.username}${t.first_name?" - "+t.first_name+t.last_name:""}`,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e[14]||(e[14]=b("div",{style:{"font-size":"12px",color:"#909399","margin-top":"5px"}}," 关联人可以查看和管理此项目，阶段负责人会自动加入关联人 ",-1))]),_:1}),l(_,{label:"项目描述"},{default:o(()=>[l(U,{modelValue:n.description,"onUpdate:modelValue":e[5]||(e[5]=t=>n.description=t),type:"textarea",rows:3,placeholder:"项目描述（可不填）"},null,8,["modelValue"])]),_:1}),l(_,{label:"状态"},{default:o(()=>[l(x,{modelValue:n.status,"onUpdate:modelValue":e[6]||(e[6]=t=>n.status=t),disabled:""},{default:o(()=>[l(i,{label:"未开始",value:"not_started"}),l(i,{label:"进行中",value:"in_progress"}),l(i,{label:"已完成",value:"completed"})]),_:1},8,["modelValue"]),e[15]||(e[15]=b("div",{style:{"font-size":"12px",color:"#909399","margin-top":"5px"}}," 状态由阶段自动决定，不可手动修改 ",-1))]),_:1}),l(_,{label:"优先级"},{default:o(()=>[l(x,{modelValue:n.priority,"onUpdate:modelValue":e[7]||(e[7]=t=>n.priority=t)},{default:o(()=>[l(i,{label:"低",value:"low"}),l(i,{label:"中",value:"medium"}),l(i,{label:"高",value:"high"}),l(i,{label:"紧急",value:"urgent"})]),_:1},8,["modelValue"])]),_:1}),l(Y,{type:"info",closable:!1,style:{"margin-top":"10px"},"show-icon":""},{default:o(()=>[...e[16]||(e[16]=[u(" 项目的开始日期和截止日期将根据阶段完成情况自动计算 ",-1)])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},fe=te(me,[["__scopeId","data-v-2bd36d42"]]);export{fe as default};
