import{_ as R,u as U,r as v,z as F,o as P,c as l,a as n,b as c,w as u,d as p,F as T,v as $,h as f,E as d,j as q,e as o,x as y,t as i,f as j,g,q as L,k as b}from"./index-DbjfBYFQ.js";const A={class:"mobile-tasks"},G={class:"filters"},H={key:0,class:"empty-tip"},J={key:1,class:"task-list"},K={class:"task-header"},O={class:"task-step"},Q={class:"task-title"},W={class:"task-project"},X={class:"task-info"},Y={key:0},Z={__name:"Tasks",setup(ee){q();const w=U(),C=v([]),k=v([]),_=v(null),m=v(null),V=F(()=>{var t;let s=C.value;return(t=w.userInfo)!=null&&t.id&&(s=s.filter(a=>a.owner===w.userInfo.id)),_.value&&(s=s.filter(a=>a.project===_.value)),m.value&&(s=s.filter(a=>a.status===m.value)),s}),x=s=>({in_progress:"warning",overdue:"danger",completed:"success"})[s]||"info",B=s=>({in_progress:"进行中",overdue:"已超期",completed:"已完成"})[s]||s,h=async()=>{try{const t=(await f.get("/api/projects/stages/",{params:{page_size:100}})).data.results||[],a={};k.value.forEach(r=>{a[r.id]=r.name}),C.value=t.map(r=>({...r,project_name:a[r.project]||"未知项目"}))}catch{d.error("加载任务列表失败")}},E=async()=>{try{const s=await f.get("/api/projects/",{params:{page_size:100}});k.value=s.data.results||[],h()}catch{d.error("加载项目列表失败")}},M=async s=>{try{await f.post(`/api/projects/stages/${s.id}/done/`),d.success("已完成"),h()}catch{d.error("操作失败")}},N=async s=>{try{await f.post(`/api/projects/stages/${s.id}/redo/`),d.success("已改为重做中"),h()}catch{d.error("操作失败")}};return P(()=>{E()}),(s,t)=>{const a=p("el-option"),r=p("el-select"),D=p("el-tag"),z=p("el-button"),I=p("el-card");return o(),l("div",A,[n("div",G,[c(r,{modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=e=>_.value=e),clearable:"",placeholder:"筛选项目",size:"default"},{default:u(()=>[(o(!0),l(T,null,$(k.value,e=>(o(),y(a,{key:e.id,label:e.name,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),c(r,{modelValue:m.value,"onUpdate:modelValue":t[1]||(t[1]=e=>m.value=e),clearable:"",placeholder:"筛选状态",size:"default"},{default:u(()=>[c(a,{label:"进行中",value:"in_progress"}),c(a,{label:"已超期",value:"overdue"}),c(a,{label:"已完成",value:"completed"})]),_:1},8,["modelValue"])]),V.value.length===0?(o(),l("div",H,"暂无任务")):(o(),l("div",J,[(o(!0),l(T,null,$(V.value,e=>(o(),y(I,{key:e.id,class:"task-card",onClick:S=>s.$router.push(`/m/projects/${e.project}`)},{default:u(()=>[n("div",K,[n("div",O,"Step "+i(e.order+1),1),c(D,{type:x(e.status),size:"small"},{default:u(()=>[j(i(B(e.status)),1)]),_:2},1032,["type"])]),n("div",Q,i(e.name),1),n("div",W,"项目: "+i(e.project_name),1),n("div",X,[e.owner_name?(o(),l("span",Y,"👤 "+i(e.owner_name),1)):g("",!0),e.deadline?(o(),l("span",{key:1,class:L({overdue:e.status==="overdue"})}," 📅 "+i(e.deadline),3)):g("",!0)]),n("div",{class:"task-actions",onClick:t[2]||(t[2]=b(()=>{},["stop"]))},[e.status!=="completed"?(o(),y(z,{key:0,type:e.status==="overdue"?"danger":"success",size:"small",onClick:b(S=>M(e),["stop"])},{default:u(()=>[...t[3]||(t[3]=[j(" Done ",-1)])]),_:1},8,["type","onClick"])):g("",!0),e.status==="completed"?(o(),y(z,{key:1,type:"warning",size:"small",onClick:b(S=>N(e),["stop"])},{default:u(()=>[...t[4]||(t[4]=[j(" Redo ",-1)])]),_:1},8,["onClick"])):g("",!0)])]),_:2},1032,["onClick"]))),128))]))])}}},te=R(Z,[["__scopeId","data-v-5f2bd572"]]);export{te as default};
