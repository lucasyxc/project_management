import{_ as J,r as i,i as K,o as Q,c as U,b as e,w as a,d as s,h as f,E as d,e as k,f as p,t as B,a as P,F as R,s as W,q as X,v as Z}from"./index-B4OK-yx2.js";const ee={class:"tasks"},te={class:"card-header"},le={__name:"Tasks",setup(ae){const w=i([]),V=i([]),y=i(1),j=i(20),x=i(0),m=i(!1),g=i(null),n=K({title:"",description:"",project:null,status:"todo",priority:"medium",due_date:""}),$=o=>({todo:"info",in_progress:"warning",review:"",completed:"success"})[o]||"info",M=o=>({todo:"待办",in_progress:"进行中",review:"待审核",completed:"已完成"})[o]||o,z=o=>({low:"info",medium:"",high:"warning",urgent:"danger"})[o]||"",D=o=>({low:"低",medium:"中",high:"高",urgent:"紧急"})[o]||o,v=async()=>{try{const o=await f.get("/api/tasks/",{params:{page:y.value}});w.value=o.data.results||[],x.value=o.data.count||0}catch{d.error("加载任务列表失败")}},E=async()=>{try{const o=await f.get("/api/projects/",{params:{page_size:100}});V.value=o.data.results||[]}catch{d.error("加载项目列表失败")}},S=o=>{g.value=o,Object.assign(n,o),m.value=!0},Y=async()=>{try{g.value?(await f.put(`/api/tasks/${g.value.id}/`,n),d.success("任务更新成功")):(await f.post("/api/tasks/",n),d.success("任务创建成功")),m.value=!1,v()}catch{d.error("保存失败")}},q=async o=>{try{await Z.confirm("确定要删除此任务吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await f.delete(`/api/tasks/${o.id}/`),d.success("任务删除成功"),v()}catch(t){t!=="cancel"&&d.error("删除失败")}};return Q(()=>{v(),E()}),(o,t)=>{const F=s("Plus"),N=s("el-icon"),_=s("el-button"),u=s("el-table-column"),T=s("el-tag"),H=s("el-table"),h=s("el-pagination"),I=s("el-card"),C=s("el-input"),c=s("el-form-item"),r=s("el-option"),b=s("el-select"),L=s("el-date-picker"),O=s("el-form"),A=s("el-dialog");return k(),U("div",ee,[e(I,null,{header:a(()=>[P("div",te,[t[11]||(t[11]=P("h3",null,"任务列表",-1)),e(_,{type:"primary",onClick:t[0]||(t[0]=l=>m.value=!0)},{default:a(()=>[e(N,null,{default:a(()=>[e(F)]),_:1}),t[10]||(t[10]=p(" 新建任务 ",-1))]),_:1})])]),default:a(()=>[e(H,{data:w.value,stripe:""},{default:a(()=>[e(u,{prop:"title",label:"任务标题","min-width":"200"}),e(u,{prop:"project_name",label:"所属项目",width:"150"}),e(u,{prop:"assignee_name",label:"负责人",width:"120"}),e(u,{prop:"status",label:"状态",width:"100"},{default:a(({row:l})=>[e(T,{type:$(l.status)},{default:a(()=>[p(B(M(l.status)),1)]),_:2},1032,["type"])]),_:1}),e(u,{prop:"priority",label:"优先级",width:"100"},{default:a(({row:l})=>[e(T,{type:z(l.priority)},{default:a(()=>[p(B(D(l.priority)),1)]),_:2},1032,["type"])]),_:1}),e(u,{prop:"due_date",label:"截止日期",width:"180"}),e(u,{label:"操作",width:"120",fixed:"right"},{default:a(({row:l})=>[e(_,{link:"",type:"primary",onClick:G=>S(l)},{default:a(()=>[...t[12]||(t[12]=[p("编辑",-1)])]),_:1},8,["onClick"]),e(_,{link:"",type:"danger",onClick:G=>q(l)},{default:a(()=>[...t[13]||(t[13]=[p("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),e(h,{"current-page":y.value,"onUpdate:currentPage":t[1]||(t[1]=l=>y.value=l),"page-size":j.value,total:x.value,layout:"total, prev, pager, next",onCurrentChange:v},null,8,["current-page","page-size","total"])]),_:1}),e(A,{modelValue:m.value,"onUpdate:modelValue":t[9]||(t[9]=l=>m.value=l),title:g.value?"编辑任务":"新建任务",width:"600px"},{footer:a(()=>[e(_,{onClick:t[8]||(t[8]=l=>m.value=!1)},{default:a(()=>[...t[14]||(t[14]=[p("取消",-1)])]),_:1}),e(_,{type:"primary",onClick:Y},{default:a(()=>[...t[15]||(t[15]=[p("保存",-1)])]),_:1})]),default:a(()=>[e(O,{model:n,"label-width":"100px"},{default:a(()=>[e(c,{label:"任务标题",required:""},{default:a(()=>[e(C,{modelValue:n.title,"onUpdate:modelValue":t[2]||(t[2]=l=>n.title=l)},null,8,["modelValue"])]),_:1}),e(c,{label:"任务描述"},{default:a(()=>[e(C,{modelValue:n.description,"onUpdate:modelValue":t[3]||(t[3]=l=>n.description=l),type:"textarea",rows:3},null,8,["modelValue"])]),_:1}),e(c,{label:"所属项目",required:""},{default:a(()=>[e(b,{modelValue:n.project,"onUpdate:modelValue":t[4]||(t[4]=l=>n.project=l),placeholder:"选择项目"},{default:a(()=>[(k(!0),U(R,null,W(V.value,l=>(k(),X(r,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"状态"},{default:a(()=>[e(b,{modelValue:n.status,"onUpdate:modelValue":t[5]||(t[5]=l=>n.status=l)},{default:a(()=>[e(r,{label:"待办",value:"todo"}),e(r,{label:"进行中",value:"in_progress"}),e(r,{label:"待审核",value:"review"}),e(r,{label:"已完成",value:"completed"})]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"优先级"},{default:a(()=>[e(b,{modelValue:n.priority,"onUpdate:modelValue":t[6]||(t[6]=l=>n.priority=l)},{default:a(()=>[e(r,{label:"低",value:"low"}),e(r,{label:"中",value:"medium"}),e(r,{label:"高",value:"high"}),e(r,{label:"紧急",value:"urgent"})]),_:1},8,["modelValue"])]),_:1}),e(c,{label:"截止日期"},{default:a(()=>[e(L,{modelValue:n.due_date,"onUpdate:modelValue":t[7]||(t[7]=l=>n.due_date=l),type:"datetime","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},ne=J(le,[["__scopeId","data-v-2ee463dd"]]);export{ne as default};
