import{_ as I,u as C,r as y,o as L,c as v,b as s,w as e,d,h as P,e as i,a as t,t as l,x as S,F as $,v as B,f as D}from"./index-DvnI5NRD.js";const R={class:"dashboard"},V={class:"stats-content"},W={class:"stats-value"},E={class:"stats-content"},M={class:"stats-value"},O={class:"stats-content"},z={class:"stats-value"},U={class:"stats-content"},q={class:"stats-value"},A={key:1},G=["onClick"],H={class:"project-name"},J={class:"project-meta"},K={key:1},Q=["onClick"],X={class:"task-title"},Y={class:"task-meta"},Z={__name:"Dashboard",setup(ss){C();const _=y({totalProjects:0,totalTasks:0,inProgressTasks:0,overdueTasks:0}),g=y([]),h=y([]),T=r=>({not_started:"info",in_progress:"warning",completed:"success",todo:"info",review:""})[r]||"info",j=r=>({not_started:"未开始",in_progress:"进行中",completed:"已完成",todo:"待办",review:"待审核"})[r]||r,F=async()=>{var r,a;try{const f=C(),u=await P.get("/api/projects/");g.value=((r=u.data.results)==null?void 0:r.slice(0,5))||[],_.value.totalProjects=u.data.count||0;const c=(await P.get("/api/projects/stages/",{params:{page_size:1e3}})).data.results||[],m={};(a=u.data.results)==null||a.forEach(n=>{m[n.id]=n.name});const k=c.map(n=>({...n,project_name:m[n.project]||"未知项目"}));_.value.totalTasks=c.length,_.value.inProgressTasks=c.filter(n=>n.status==="in_progress").length,_.value.overdueTasks=c.filter(n=>n.status==="overdue").length,f.userInfo&&(h.value=k.filter(n=>n.owner===f.userInfo.id).slice(0,5))}catch(f){console.error("加载数据失败:",f)}};return L(()=>{F()}),(r,a)=>{const f=d("FolderOpened"),u=d("el-icon"),p=d("el-card"),c=d("el-col"),m=d("List"),k=d("Clock"),n=d("Warning"),w=d("el-row"),b=d("el-empty"),x=d("el-tag");return i(),v("div",R,[s(w,{gutter:20},{default:e(()=>[s(c,{span:6},{default:e(()=>[s(p,{class:"stats-card"},{default:e(()=>[t("div",V,[s(u,{class:"stats-icon",color:"#409eff"},{default:e(()=>[s(f)]),_:1}),t("div",null,[t("div",W,l(_.value.totalProjects),1),a[0]||(a[0]=t("div",{class:"stats-label"},"总项目数",-1))])])]),_:1})]),_:1}),s(c,{span:6},{default:e(()=>[s(p,{class:"stats-card"},{default:e(()=>[t("div",E,[s(u,{class:"stats-icon",color:"#67c23a"},{default:e(()=>[s(m)]),_:1}),t("div",null,[t("div",M,l(_.value.totalTasks),1),a[1]||(a[1]=t("div",{class:"stats-label"},"总阶段数",-1))])])]),_:1})]),_:1}),s(c,{span:6},{default:e(()=>[s(p,{class:"stats-card"},{default:e(()=>[t("div",O,[s(u,{class:"stats-icon",color:"#e6a23c"},{default:e(()=>[s(k)]),_:1}),t("div",null,[t("div",z,l(_.value.inProgressTasks),1),a[2]||(a[2]=t("div",{class:"stats-label"},"进行中",-1))])])]),_:1})]),_:1}),s(c,{span:6},{default:e(()=>[s(p,{class:"stats-card"},{default:e(()=>[t("div",U,[s(u,{class:"stats-icon",color:"#f56c6c"},{default:e(()=>[s(n)]),_:1}),t("div",null,[t("div",q,l(_.value.overdueTasks),1),a[3]||(a[3]=t("div",{class:"stats-label"},"已超期",-1))])])]),_:1})]),_:1})]),_:1}),s(w,{gutter:20,style:{"margin-top":"20px"}},{default:e(()=>[s(c,{span:12},{default:e(()=>[s(p,null,{header:e(()=>[...a[4]||(a[4]=[t("h3",null,"最近项目",-1)])]),default:e(()=>[g.value.length===0?(i(),S(b,{key:0,description:"暂无项目"})):(i(),v("div",A,[(i(!0),v($,null,B(g.value,o=>(i(),v("div",{key:o.id,class:"project-item",onClick:N=>r.$router.push(`/projects/${o.id}`)},[t("div",null,[t("div",H,l(o.name),1),t("div",J,l(o.owner_name)+" · "+l(o.created_at),1)]),s(x,{type:T(o.status)},{default:e(()=>[D(l(j(o.status)),1)]),_:2},1032,["type"])],8,G))),128))]))]),_:1})]),_:1}),s(c,{span:12},{default:e(()=>[s(p,null,{header:e(()=>[...a[5]||(a[5]=[t("h3",null,"我的任务（我负责的阶段）",-1)])]),default:e(()=>[h.value.length===0?(i(),S(b,{key:0,description:"暂无任务"})):(i(),v("div",K,[(i(!0),v($,null,B(h.value,o=>(i(),v("div",{key:o.id,class:"task-item",onClick:N=>r.$router.push(`/projects/${o.project}`)},[t("div",null,[t("div",X,l(o.name),1),t("div",Y,l(o.project_name)+" · "+l(o.deadline||"无截止日期"),1)]),s(x,{type:T(o.status)},{default:e(()=>[D(l(j(o.status)),1)]),_:2},1032,["type"])],8,Q))),128))]))]),_:1})]),_:1})]),_:1})])}}},es=I(Z,[["__scopeId","data-v-073813a7"]]);export{es as default};
