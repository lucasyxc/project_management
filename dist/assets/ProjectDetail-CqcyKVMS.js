import{_ as oe,r as k,i as re,x as Y,o as ne,c as p,g,b as o,w as a,d as v,h as f,s as ie,E as i,e as n,a as r,t as d,f as u,F as M,v as z,z as h,A as F}from"./index-TwG3oDm_.js";const de={key:0,class:"mobile-project-detail"},ue={class:"project-name"},ce={class:"project-meta"},pe={class:"project-progress-bar"},me={class:"progress-value"},ve={key:0,class:"project-desc"},_e={class:"project-info-row"},fe={class:"project-info-row"},ge={class:"members-section"},ye={class:"members-tags"},we={key:1,class:"project-info-row"},be={class:"card-header"},ke={key:0,class:"empty-tip"},Ve={key:1,class:"stage-list"},je={class:"stage-header"},xe={class:"stage-step"},he={class:"stage-name"},Ce={key:0,class:"stage-desc"},Se={class:"stage-info"},$e={key:0},Me={key:1},ze={class:"stage-actions"},Te={__name:"ProjectDetail",setup(De){const D=ie(),l=k(null),C=k([]),V=k(!1),j=k(!1),y=k(null),x=k([]),c=re({name:"",description:"",deadline:"",owner:null}),T=Y(()=>!l.value||!l.value.stages?[]:[...l.value.stages].sort((t,e)=>t.order-e.order)),O=t=>({not_started:"info",in_progress:"warning",completed:"success"})[t]||"info",R=t=>({not_started:"æœªå¼€å§‹",in_progress:"è¿›è¡Œä¸­",completed:"å·²å®Œæˆ"})[t]||t,q=t=>({low:"info",medium:"",high:"warning",urgent:"danger"})[t]||"",A=t=>({low:"ä½Ž",medium:"ä¸­",high:"é«˜",urgent:"ç´§æ€¥"})[t]||t,L=Y(()=>{if(!l.value||!C.value)return[];const t=(l.value.members_detail||[]).map(e=>e.id);return C.value.filter(e=>!t.includes(e.id))}),G=t=>({in_progress:"warning",overdue:"danger",completed:"success"})[t]||"info",H=t=>({in_progress:"è¿›è¡Œä¸­",overdue:"å·²è¶…æœŸ",completed:"å·²å®Œæˆ"})[t]||t,w=async()=>{try{const t=await f.get(`/api/projects/${D.params.id}/`);l.value=t.data}catch{i.error("åŠ è½½é¡¹ç›®è¯¦æƒ…å¤±è´¥")}},J=async()=>{try{const t=await f.get("/api/users/",{params:{page_size:100}});C.value=(t.data.results||[]).filter(e=>e.username!=="admin")}catch{console.error("åŠ è½½ç”¨æˆ·åˆ—è¡¨å¤±è´¥")}},K=t=>{y.value=t,Object.assign(c,{name:t.name,description:t.description||"",deadline:t.deadline||"",owner:t.owner||null}),V.value=!0},Q=async()=>{if(!c.name){i.warning("è¯·è¾“å…¥é˜¶æ®µåç§°");return}try{const t=T.value.length>0?Math.max(...T.value.map(m=>m.order)):-1,e={...c,project:D.params.id,order:y.value?y.value.order:t+1,status:"in_progress"};e.deadline||(e.deadline=null),e.owner||(e.owner=null),e.description||(e.description=""),y.value?(await f.put(`/api/projects/stages/${y.value.id}/`,e),i.success("é˜¶æ®µæ›´æ–°æˆåŠŸ")):(await f.post("/api/projects/stages/",e),i.success("é˜¶æ®µæ·»åŠ æˆåŠŸ")),B(),w()}catch{i.error("ä¿å­˜å¤±è´¥")}},W=async t=>{try{await f.post(`/api/projects/stages/${t.id}/done/`),i.success("é˜¶æ®µå·²å®Œæˆ"),w()}catch{i.error("æ“ä½œå¤±è´¥")}},X=async t=>{try{await f.post(`/api/projects/stages/${t.id}/redo/`),i.success("å·²æ”¹ä¸ºé‡åšä¸­"),w()}catch{i.error("æ“ä½œå¤±è´¥")}},Z=async t=>{try{await F.confirm(`ç¡®å®šåˆ é™¤"${t.name}"?`,"æç¤º",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"}),await f.delete(`/api/projects/stages/${t.id}/`),i.success("é˜¶æ®µåˆ é™¤æˆåŠŸ"),w()}catch(e){e!=="cancel"&&i.error("åˆ é™¤å¤±è´¥")}},B=()=>{V.value=!1,y.value=null,Object.assign(c,{name:"",description:"",deadline:"",owner:null})},ee=async()=>{if(x.value.length===0){i.warning("è¯·é€‰æ‹©è¦æ·»åŠ çš„å…³è”äºº");return}try{const e=[...(l.value.members_detail||[]).map(m=>m.id),...x.value];await f.patch(`/api/projects/${l.value.id}/`,{members:e}),i.success("å…³è”äººæ·»åŠ æˆåŠŸ"),j.value=!1,x.value=[],w()}catch{i.error("æ·»åŠ å¤±è´¥")}},te=async t=>{try{await F.confirm(`ç¡®å®šè¦ç§»é™¤å…³è”äºº"${t.username}"ï¼Ÿ`,"æç¤º",{confirmButtonText:"ç¡®å®š",cancelButtonText:"å–æ¶ˆ",type:"warning"});const e=(l.value.members_detail||[]).map(m=>m.id).filter(m=>m!==t.id);await f.patch(`/api/projects/${l.value.id}/`,{members:e}),i.success("å…³è”äººç§»é™¤æˆåŠŸ"),w()}catch(e){e!=="cancel"&&i.error("ç§»é™¤å¤±è´¥")}};return ne(()=>{w(),J()}),(t,e)=>{const m=v("el-tag"),se=v("el-progress"),_=v("el-button"),U=v("el-card"),I=v("el-input"),S=v("el-form-item"),P=v("el-option"),E=v("el-select"),le=v("el-date-picker"),ae=v("el-form"),N=v("el-dialog");return l.value?(n(),p("div",de,[o(U,{class:"info-card"},{default:a(()=>{var s;return[r("div",ue,d(l.value.name),1),r("div",ce,[o(m,{type:O(l.value.status),size:"small"},{default:a(()=>[u(d(R(l.value.status)),1)]),_:1},8,["type"]),o(m,{type:q(l.value.priority),size:"small"},{default:a(()=>[u(d(A(l.value.priority)),1)]),_:1},8,["type"])]),r("div",pe,[e[10]||(e[10]=r("span",null,"è¿›åº¦",-1)),o(se,{percentage:l.value.progress,"show-text":!1,style:{flex:"1",margin:"0 10px"}},null,8,["percentage"]),r("span",me,d(l.value.progress)+"%",1)]),l.value.description?(n(),p("div",ve,d(l.value.description),1)):g("",!0),r("div",_e,[r("span",null,"è´Ÿè´£äºº: "+d(((s=l.value.owner_detail)==null?void 0:s.username)||"æœªæŒ‡å®š"),1)]),r("div",fe,[r("div",ge,[e[12]||(e[12]=r("div",{class:"members-label"},"å…³è”äºº:",-1)),r("div",ye,[(n(!0),p(M,null,z(l.value.members_detail||[],b=>(n(),h(m,{key:b.id,size:"small",closable:"",onClose:$=>te(b),style:{"margin-right":"5px","margin-bottom":"5px"}},{default:a(()=>[u(d(b.username),1)]),_:2},1032,["onClose"]))),128)),o(_,{size:"small",type:"primary",onClick:e[0]||(e[0]=b=>j.value=!0)},{default:a(()=>[...e[11]||(e[11]=[u(" æ·»åŠ  ",-1)])]),_:1})])])]),l.value.start_date||l.value.end_date?(n(),p("div",we,[r("span",null,d(l.value.start_date||"-")+" ~ "+d(l.value.end_date||"-"),1)])):g("",!0)]}),_:1}),o(U,{class:"stages-card"},{header:a(()=>[r("div",be,[e[14]||(e[14]=r("h4",null,"é¡¹ç›®é˜¶æ®µ",-1)),o(_,{type:"primary",size:"small",onClick:e[1]||(e[1]=s=>V.value=!0)},{default:a(()=>[...e[13]||(e[13]=[u(" æ·»åŠ é˜¶æ®µ ",-1)])]),_:1})])]),default:a(()=>[!l.value.stages||l.value.stages.length===0?(n(),p("div",ke," æš‚æ— é˜¶æ®µï¼Œç‚¹å‡»å³ä¸Šè§’æ·»åŠ  ")):(n(),p("div",Ve,[(n(!0),p(M,null,z(T.value,(s,b)=>(n(),p("div",{key:s.id,class:"stage-item"},[r("div",je,[r("div",xe,"Step "+d(b+1),1),o(m,{type:G(s.status),size:"small"},{default:a(()=>[u(d(H(s.status)),1)]),_:2},1032,["type"])]),r("div",he,d(s.name),1),s.description?(n(),p("div",Ce,d(s.description),1)):g("",!0),r("div",Se,[s.owner_name?(n(),p("span",$e,"ðŸ‘¤ "+d(s.owner_name),1)):g("",!0),s.deadline?(n(),p("span",Me,"ðŸ“… "+d(s.deadline),1)):g("",!0)]),r("div",ze,[s.status!=="completed"?(n(),h(_,{key:0,type:s.status==="overdue"?"danger":"success",size:"small",onClick:$=>W(s)},{default:a(()=>[...e[15]||(e[15]=[u(" Done ",-1)])]),_:1},8,["type","onClick"])):g("",!0),s.status==="completed"?(n(),h(_,{key:1,type:"warning",size:"small",onClick:$=>X(s)},{default:a(()=>[...e[16]||(e[16]=[u(" Redo ",-1)])]),_:1},8,["onClick"])):g("",!0),o(_,{size:"small",onClick:$=>K(s)},{default:a(()=>[...e[17]||(e[17]=[u("ç¼–è¾‘",-1)])]),_:1},8,["onClick"]),o(_,{size:"small",type:"danger",onClick:$=>Z(s)},{default:a(()=>[...e[18]||(e[18]=[u("åˆ é™¤",-1)])]),_:1},8,["onClick"])])]))),128))]))]),_:1}),o(N,{modelValue:V.value,"onUpdate:modelValue":e[6]||(e[6]=s=>V.value=s),title:y.value?"ç¼–è¾‘é˜¶æ®µ":"æ·»åŠ é˜¶æ®µ",fullscreen:!0},{footer:a(()=>[o(_,{onClick:B,style:{width:"48%"}},{default:a(()=>[...e[19]||(e[19]=[u("å–æ¶ˆ",-1)])]),_:1}),o(_,{type:"primary",onClick:Q,style:{width:"48%"}},{default:a(()=>[...e[20]||(e[20]=[u("ä¿å­˜",-1)])]),_:1})]),default:a(()=>[o(ae,{model:c,"label-position":"top"},{default:a(()=>[o(S,{label:"é˜¶æ®µåç§°",required:""},{default:a(()=>[o(I,{modelValue:c.name,"onUpdate:modelValue":e[2]||(e[2]=s=>c.name=s),placeholder:"ä¾‹å¦‚: Step1ã€éœ€æ±‚åˆ†æž"},null,8,["modelValue"])]),_:1}),o(S,{label:"é˜¶æ®µæè¿°"},{default:a(()=>[o(I,{modelValue:c.description,"onUpdate:modelValue":e[3]||(e[3]=s=>c.description=s),type:"textarea",rows:4,placeholder:"é˜¶æ®µè¯´æ˜Žï¼ˆå¯ä¸å¡«ï¼‰"},null,8,["modelValue"])]),_:1}),o(S,{label:"è´Ÿè´£äºº"},{default:a(()=>[o(E,{modelValue:c.owner,"onUpdate:modelValue":e[4]||(e[4]=s=>c.owner=s),clearable:"",placeholder:"é€‰æ‹©è´Ÿè´£äººï¼ˆå¯ä¸é€‰ï¼‰",style:{width:"100%"}},{default:a(()=>[(n(!0),p(M,null,z(C.value,s=>(n(),h(P,{key:s.id,label:s.username,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(S,{label:"æˆªæ­¢æ—¥æœŸ"},{default:a(()=>[o(le,{modelValue:c.deadline,"onUpdate:modelValue":e[5]||(e[5]=s=>c.deadline=s),type:"date","value-format":"YYYY-MM-DD",placeholder:"å¯ä¸é€‰",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),o(N,{modelValue:j.value,"onUpdate:modelValue":e[9]||(e[9]=s=>j.value=s),title:"æ·»åŠ å…³è”äºº",width:"90%"},{footer:a(()=>[o(_,{onClick:e[8]||(e[8]=s=>j.value=!1),style:{width:"48%"}},{default:a(()=>[...e[21]||(e[21]=[u("å–æ¶ˆ",-1)])]),_:1}),o(_,{type:"primary",onClick:ee,style:{width:"48%"}},{default:a(()=>[...e[22]||(e[22]=[u("æ·»åŠ ",-1)])]),_:1})]),default:a(()=>[o(E,{modelValue:x.value,"onUpdate:modelValue":e[7]||(e[7]=s=>x.value=s),multiple:"",placeholder:"é€‰æ‹©è¦æ·»åŠ çš„å…³è”äºº",style:{width:"100%"}},{default:a(()=>[(n(!0),p(M,null,z(L.value,s=>(n(),h(P,{key:s.id,label:s.username,value:s.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},8,["modelValue"])])):g("",!0)}}},Ue=oe(Te,[["__scopeId","data-v-cb20fdbd"]]);export{Ue as default};
