import{_ as C,u as $,r as f,o as D,c as i,a as s,b as v,t as a,w as _,d as T,h as j,e as n,F as b,v as w,f as P}from"./index-DbjfBYFQ.js";const I={class:"mobile-dashboard"},N={class:"stats-grid"},z={class:"stat-card"},B={class:"stat-value"},R={class:"stat-card"},V={class:"stat-value"},E={class:"stat-card"},F={class:"stat-value"},M={class:"stat-card"},L={class:"stat-value",style:{color:"#f56c6c"}},U={key:0,class:"empty-tip"},W={key:1,class:"project-list"},q=["onClick"],A={class:"item-main"},G={class:"item-title"},H={class:"item-meta"},J={class:"item-side"},K={class:"progress-text"},O={key:0,class:"empty-tip"},Q={key:1,class:"task-list"},X=["onClick"],Y={class:"item-main"},Z={class:"item-title"},ss={class:"item-meta"},ts={__name:"Dashboard",setup(es){const p=$(),r=f({totalProjects:0,totalTasks:0,inProgressTasks:0,overdueTasks:0}),m=f([]),h=f([]),y=o=>({not_started:"info",in_progress:"warning",completed:"success",overdue:"danger"})[o]||"info",k=o=>({not_started:"未开始",in_progress:"进行中",completed:"已完成",overdue:"已超期"})[o]||o,x=async()=>{var o,e;try{const d=await j.get("/api/projects/");m.value=((o=d.data.results)==null?void 0:o.slice(0,5))||[],r.value.totalProjects=d.data.count||0;const t=(await j.get("/api/projects/stages/",{params:{page_size:1e3}})).data.results||[],u={};(e=d.data.results)==null||e.forEach(l=>{u[l.id]=l.name});const S=t.map(l=>({...l,project_name:u[l.project]||"未知项目"}));if(p.userInfo){const l=t.filter(c=>c.owner===p.userInfo.id);r.value.totalTasks=l.length,r.value.inProgressTasks=l.filter(c=>c.status==="in_progress").length,r.value.overdueTasks=l.filter(c=>c.status==="overdue").length,h.value=S.filter(c=>c.owner===p.userInfo.id).slice(0,5)}}catch(d){console.error("加载数据失败:",d)}};return D(()=>{x()}),(o,e)=>{const d=T("el-tag"),g=T("el-card");return n(),i("div",I,[s("div",N,[s("div",z,[s("div",B,a(r.value.totalProjects),1),e[0]||(e[0]=s("div",{class:"stat-label"},"总项目",-1))]),s("div",R,[s("div",V,a(r.value.totalTasks),1),e[1]||(e[1]=s("div",{class:"stat-label"},"我的阶段",-1))]),s("div",E,[s("div",F,a(r.value.inProgressTasks),1),e[2]||(e[2]=s("div",{class:"stat-label"},"进行中",-1))]),s("div",M,[s("div",L,a(r.value.overdueTasks),1),e[3]||(e[3]=s("div",{class:"stat-label"},"已超期",-1))])]),v(g,{class:"section-card"},{header:_(()=>[...e[4]||(e[4]=[s("h4",null,"最近项目",-1)])]),default:_(()=>[m.value.length===0?(n(),i("div",U,"暂无项目")):(n(),i("div",W,[(n(!0),i(b,null,w(m.value,t=>(n(),i("div",{key:t.id,class:"list-item",onClick:u=>o.$router.push(`/m/projects/${t.id}`)},[s("div",A,[s("div",G,a(t.name),1),s("div",H,a(t.owner_name),1)]),s("div",J,[v(d,{type:y(t.status),size:"small"},{default:_(()=>[P(a(k(t.status)),1)]),_:2},1032,["type"]),s("div",K,a(t.progress)+"%",1)])],8,q))),128))]))]),_:1}),v(g,{class:"section-card"},{header:_(()=>[...e[5]||(e[5]=[s("h4",null,"我的任务",-1)])]),default:_(()=>[h.value.length===0?(n(),i("div",O,"暂无任务")):(n(),i("div",Q,[(n(!0),i(b,null,w(h.value,t=>(n(),i("div",{key:t.id,class:"list-item",onClick:u=>o.$router.push(`/m/projects/${t.project}`)},[s("div",Y,[s("div",Z,a(t.name),1),s("div",ss,a(t.project_name)+" · "+a(t.deadline||"无截止"),1)]),v(d,{type:y(t.status),size:"small"},{default:_(()=>[P(a(k(t.status)),1)]),_:2},1032,["type"])],8,X))),128))]))]),_:1})])}}},os=C(ts,[["__scopeId","data-v-2d56c470"]]);export{os as default};
