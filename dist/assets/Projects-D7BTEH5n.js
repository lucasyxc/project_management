import{_ as J,r as w,i as K,o as Q,c,b as o,w as s,d as a,F as C,v as h,h as g,E as u,e as r,f as d,x as j,a as i,t as v,k as U,y as R}from"./index-DvnI5NRD.js";const W={class:"mobile-projects"},X={key:0,class:"empty-tip"},Y={key:1,class:"project-list"},Z={class:"project-header"},ee={class:"project-title"},te={class:"project-info"},le={class:"project-progress"},oe={class:"project-actions"},se={__name:"Projects",setup(ne){const b=w([]),x=w([]),m=w(!1),_=w(null),n=K({name:"",description:"",status:"not_started",priority:"low",owner:null,members:[]}),z=l=>({not_started:"info",in_progress:"warning",completed:"success"})[l]||"info",E=l=>({not_started:"未开始",in_progress:"进行中",completed:"已完成"})[l]||l,M=l=>({low:"info",medium:"",high:"warning",urgent:"danger"})[l]||"",D=l=>({low:"低",medium:"中",high:"高",urgent:"紧急"})[l]||l,V=async()=>{try{const l=await g.get("/api/projects/");b.value=l.data.results||[]}catch{u.error("加载项目列表失败")}},F=async()=>{try{const l=await g.get("/api/users/",{params:{page_size:100}});x.value=(l.data.results||[]).filter(e=>e.username!=="admin")}catch{console.error("加载用户列表失败")}},N=l=>{_.value=l,Object.assign(n,{...l,members:l.members||[]}),m.value=!0},S=async()=>{if(!n.name){u.warning("请输入项目名称");return}try{const l={...n};l.owner||(l.owner=null),l.description||(l.description=""),_.value?(await g.put(`/api/projects/${_.value.id}/`,l),u.success("项目更新成功")):(await g.post("/api/projects/",l),u.success("项目创建成功")),P(),V()}catch{u.error("保存失败")}},P=()=>{m.value=!1,_.value=null,Object.assign(n,{name:"",description:"",status:"not_started",priority:"low",owner:null,members:[]})},O=async l=>{try{await R.confirm("确定要删除此项目吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await g.delete(`/api/projects/${l.id}/`),u.success("项目删除成功"),V()}catch(e){e!=="cancel"&&u.error("删除失败")}};return Q(()=>{V(),F()}),(l,e)=>{const q=a("Plus"),I=a("el-icon"),f=a("el-button"),$=a("el-tag"),L=a("el-progress"),A=a("el-card"),B=a("el-input"),y=a("el-form-item"),p=a("el-option"),k=a("el-select"),G=a("el-form"),H=a("el-dialog");return r(),c("div",W,[o(f,{type:"primary",style:{width:"100%","margin-bottom":"10px"},onClick:e[0]||(e[0]=t=>m.value=!0)},{default:s(()=>[o(I,null,{default:s(()=>[o(q)]),_:1}),e[7]||(e[7]=d(" 新建项目 ",-1))]),_:1}),b.value.length===0?(r(),c("div",X,"暂无项目")):(r(),c("div",Y,[(r(!0),c(C,null,h(b.value,t=>(r(),j(A,{key:t.id,class:"project-card",onClick:T=>l.$router.push(`/m/projects/${t.id}`)},{default:s(()=>[i("div",Z,[i("div",ee,v(t.name),1),o($,{type:z(t.status),size:"small"},{default:s(()=>[d(v(E(t.status)),1)]),_:2},1032,["type"])]),i("div",te,[i("span",null,"负责人: "+v(t.owner_name||"未指定"),1),o($,{type:M(t.priority),size:"small"},{default:s(()=>[d(v(D(t.priority)),1)]),_:2},1032,["type"])]),i("div",le,[e[8]||(e[8]=i("span",null,"进度",-1)),o(L,{percentage:t.progress,"show-text":!1,style:{flex:"1",margin:"0 10px"}},null,8,["percentage"]),i("span",null,v(t.progress)+"%",1)]),i("div",oe,[o(f,{link:"",type:"primary",size:"small",onClick:U(T=>N(t),["stop"])},{default:s(()=>[...e[9]||(e[9]=[d("编辑",-1)])]),_:1},8,["onClick"]),o(f,{link:"",type:"danger",size:"small",onClick:U(T=>O(t),["stop"])},{default:s(()=>[...e[10]||(e[10]=[d("删除",-1)])]),_:1},8,["onClick"])])]),_:2},1032,["onClick"]))),128))])),o(H,{modelValue:m.value,"onUpdate:modelValue":e[6]||(e[6]=t=>m.value=t),title:_.value?"编辑项目":"新建项目",fullscreen:!0},{footer:s(()=>[o(f,{onClick:P,style:{width:"48%"}},{default:s(()=>[...e[12]||(e[12]=[d("取消",-1)])]),_:1}),o(f,{type:"primary",onClick:S,style:{width:"48%"}},{default:s(()=>[...e[13]||(e[13]=[d("保存",-1)])]),_:1})]),default:s(()=>[o(G,{model:n,"label-position":"top"},{default:s(()=>[o(y,{label:"项目名称",required:""},{default:s(()=>[o(B,{modelValue:n.name,"onUpdate:modelValue":e[1]||(e[1]=t=>n.name=t),placeholder:"输入项目名称"},null,8,["modelValue"])]),_:1}),o(y,{label:"项目负责人"},{default:s(()=>[o(k,{modelValue:n.owner,"onUpdate:modelValue":e[2]||(e[2]=t=>n.owner=t),clearable:"",placeholder:"选择负责人（可不选）",style:{width:"100%"}},{default:s(()=>[(r(!0),c(C,null,h(x.value,t=>(r(),j(p,{key:t.id,label:t.username,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(y,{label:"项目关联人"},{default:s(()=>[o(k,{modelValue:n.members,"onUpdate:modelValue":e[3]||(e[3]=t=>n.members=t),multiple:"",clearable:"",placeholder:"选择关联人（可多选）",style:{width:"100%"}},{default:s(()=>[(r(!0),c(C,null,h(x.value,t=>(r(),j(p,{key:t.id,label:t.username,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e[11]||(e[11]=i("div",{style:{"font-size":"12px",color:"#909399","margin-top":"5px"}}," 关联人可以查看和管理此项目 ",-1))]),_:1}),o(y,{label:"项目描述"},{default:s(()=>[o(B,{modelValue:n.description,"onUpdate:modelValue":e[4]||(e[4]=t=>n.description=t),type:"textarea",rows:4,placeholder:"项目描述（可不填）"},null,8,["modelValue"])]),_:1}),o(y,{label:"优先级"},{default:s(()=>[o(k,{modelValue:n.priority,"onUpdate:modelValue":e[5]||(e[5]=t=>n.priority=t),style:{width:"100%"}},{default:s(()=>[o(p,{label:"低",value:"low"}),o(p,{label:"中",value:"medium"}),o(p,{label:"高",value:"high"}),o(p,{label:"紧急",value:"urgent"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},re=J(se,[["__scopeId","data-v-373bf6d2"]]);export{re as default};
