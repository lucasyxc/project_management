import{_ as I,u as c,i as V,o as k,c as v,b as l,w as a,d as u,E as n,e as C,f as b,a as y,h as U}from"./index-TwG3oDm_.js";const P={class:"profile"},B={__name:"Profile",setup(E){const p=c(),s=V({username:"",email:"",first_name:"",last_name:"",phone:"",department:"",position:""}),t=V({old_password:"",new_password:"",confirm_password:""}),i=async()=>{try{await p.getUserInfo(),Object.assign(s,p.userInfo)}catch{n.error("加载用户信息失败")}},g=async()=>{try{await U.put(`/api/users/${p.userInfo.id}/`,s),n.success("个人信息更新成功"),await i()}catch{n.error("更新失败")}},x=async()=>{if(t.new_password!==t.confirm_password){n.error("两次输入的密码不一致");return}try{await U.put("/api/users/change_password/",{old_password:t.old_password,new_password:t.new_password}),n.success("密码修改成功"),t.old_password="",t.new_password="",t.confirm_password=""}catch{n.error("密码修改失败")}};return k(()=>{i()}),(m,e)=>{const r=u("el-input"),d=u("el-form-item"),_=u("el-button"),f=u("el-form"),w=u("el-card");return C(),v("div",P,[l(w,null,{header:a(()=>[...e[10]||(e[10]=[y("h3",null,"个人信息",-1)])]),default:a(()=>[l(f,{model:s,"label-width":"100px"},{default:a(()=>[l(d,{label:"用户名"},{default:a(()=>[l(r,{modelValue:s.username,"onUpdate:modelValue":e[0]||(e[0]=o=>s.username=o),disabled:""},null,8,["modelValue"])]),_:1}),l(d,{label:"邮箱"},{default:a(()=>[l(r,{modelValue:s.email,"onUpdate:modelValue":e[1]||(e[1]=o=>s.email=o)},null,8,["modelValue"])]),_:1}),l(d,{label:"姓名"},{default:a(()=>[l(r,{modelValue:s.first_name,"onUpdate:modelValue":e[2]||(e[2]=o=>s.first_name=o),placeholder:"姓",style:{width:"48%","margin-right":"4%"}},null,8,["modelValue"]),l(r,{modelValue:s.last_name,"onUpdate:modelValue":e[3]||(e[3]=o=>s.last_name=o),placeholder:"名",style:{width:"48%"}},null,8,["modelValue"])]),_:1}),l(d,{label:"手机号"},{default:a(()=>[l(r,{modelValue:s.phone,"onUpdate:modelValue":e[4]||(e[4]=o=>s.phone=o)},null,8,["modelValue"])]),_:1}),l(d,{label:"部门"},{default:a(()=>[l(r,{modelValue:s.department,"onUpdate:modelValue":e[5]||(e[5]=o=>s.department=o)},null,8,["modelValue"])]),_:1}),l(d,{label:"职位"},{default:a(()=>[l(r,{modelValue:s.position,"onUpdate:modelValue":e[6]||(e[6]=o=>s.position=o)},null,8,["modelValue"])]),_:1}),l(d,null,{default:a(()=>[l(_,{type:"primary",onClick:g},{default:a(()=>[...e[11]||(e[11]=[b("保存",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),l(w,{style:{"margin-top":"20px"}},{header:a(()=>[...e[12]||(e[12]=[y("h3",null,"修改密码",-1)])]),default:a(()=>[l(f,{model:t,"label-width":"100px"},{default:a(()=>[l(d,{label:"原密码"},{default:a(()=>[l(r,{modelValue:t.old_password,"onUpdate:modelValue":e[7]||(e[7]=o=>t.old_password=o),type:"password"},null,8,["modelValue"])]),_:1}),l(d,{label:"新密码"},{default:a(()=>[l(r,{modelValue:t.new_password,"onUpdate:modelValue":e[8]||(e[8]=o=>t.new_password=o),type:"password"},null,8,["modelValue"])]),_:1}),l(d,{label:"确认密码"},{default:a(()=>[l(r,{modelValue:t.confirm_password,"onUpdate:modelValue":e[9]||(e[9]=o=>t.confirm_password=o),type:"password"},null,8,["modelValue"])]),_:1}),l(d,null,{default:a(()=>[l(_,{type:"primary",onClick:x},{default:a(()=>[...e[13]||(e[13]=[b("修改密码",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})])}}},M=I(B,[["__scopeId","data-v-d3446869"]]);export{M as default};
