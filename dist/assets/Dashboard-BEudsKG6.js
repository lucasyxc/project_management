import{_ as C,u as S,r as h,o as $,c as i,a as s,b as u,t as a,w as c,d as k,h as T,e as n,F as b,v as j,f as P}from"./index-DvnI5NRD.js";const D={class:"mobile-dashboard"},N={class:"stats-grid"},z={class:"stat-card"},B={class:"stat-value"},I={class:"stat-card"},R={class:"stat-value"},V={class:"stat-card"},E={class:"stat-value"},F={class:"stat-card"},M={class:"stat-value",style:{color:"#f56c6c"}},L={key:0,class:"empty-tip"},U={key:1,class:"project-list"},W=["onClick"],q={class:"item-main"},A={class:"item-title"},G={class:"item-meta"},H={class:"item-side"},J={class:"progress-text"},K={key:0,class:"empty-tip"},O={key:1,class:"task-list"},Q=["onClick"],X={class:"item-main"},Y={class:"item-title"},Z={class:"item-meta"},ss={__name:"Dashboard",setup(ts){const g=S(),r=h({totalProjects:0,totalTasks:0,inProgressTasks:0,overdueTasks:0}),v=h([]),p=h([]),f=l=>({not_started:"info",in_progress:"warning",completed:"success",overdue:"danger"})[l]||"info",y=l=>({not_started:"未开始",in_progress:"进行中",completed:"已完成",overdue:"已超期"})[l]||l,w=async()=>{var l,e;try{const d=await T.get("/api/projects/");v.value=((l=d.data.results)==null?void 0:l.slice(0,5))||[],r.value.totalProjects=d.data.count||0;const t=(await T.get("/api/projects/stages/",{params:{page_size:1e3}})).data.results||[],_={};(e=d.data.results)==null||e.forEach(o=>{_[o.id]=o.name});const x=t.map(o=>({...o,project_name:_[o.project]||"未知项目"}));r.value.totalTasks=t.length,r.value.inProgressTasks=t.filter(o=>o.status==="in_progress").length,r.value.overdueTasks=t.filter(o=>o.status==="overdue").length,g.userInfo&&(p.value=x.filter(o=>o.owner===g.userInfo.id).slice(0,5))}catch(d){console.error("加载数据失败:",d)}};return $(()=>{w()}),(l,e)=>{const d=k("el-tag"),m=k("el-card");return n(),i("div",D,[s("div",N,[s("div",z,[s("div",B,a(r.value.totalProjects),1),e[0]||(e[0]=s("div",{class:"stat-label"},"总项目",-1))]),s("div",I,[s("div",R,a(r.value.totalTasks),1),e[1]||(e[1]=s("div",{class:"stat-label"},"总阶段",-1))]),s("div",V,[s("div",E,a(r.value.inProgressTasks),1),e[2]||(e[2]=s("div",{class:"stat-label"},"进行中",-1))]),s("div",F,[s("div",M,a(r.value.overdueTasks),1),e[3]||(e[3]=s("div",{class:"stat-label"},"已超期",-1))])]),u(m,{class:"section-card"},{header:c(()=>[...e[4]||(e[4]=[s("h4",null,"最近项目",-1)])]),default:c(()=>[v.value.length===0?(n(),i("div",L,"暂无项目")):(n(),i("div",U,[(n(!0),i(b,null,j(v.value,t=>(n(),i("div",{key:t.id,class:"list-item",onClick:_=>l.$router.push(`/m/projects/${t.id}`)},[s("div",q,[s("div",A,a(t.name),1),s("div",G,a(t.owner_name),1)]),s("div",H,[u(d,{type:f(t.status),size:"small"},{default:c(()=>[P(a(y(t.status)),1)]),_:2},1032,["type"]),s("div",J,a(t.progress)+"%",1)])],8,W))),128))]))]),_:1}),u(m,{class:"section-card"},{header:c(()=>[...e[5]||(e[5]=[s("h4",null,"我的任务",-1)])]),default:c(()=>[p.value.length===0?(n(),i("div",K,"暂无任务")):(n(),i("div",O,[(n(!0),i(b,null,j(p.value,t=>(n(),i("div",{key:t.id,class:"list-item",onClick:_=>l.$router.push(`/m/projects/${t.project}`)},[s("div",X,[s("div",Y,a(t.name),1),s("div",Z,a(t.project_name)+" · "+a(t.deadline||"无截止"),1)]),u(d,{type:f(t.status),size:"small"},{default:c(()=>[P(a(y(t.status)),1)]),_:2},1032,["type"])],8,Q))),128))]))]),_:1})])}}},as=C(ss,[["__scopeId","data-v-05b4d741"]]);export{as as default};
